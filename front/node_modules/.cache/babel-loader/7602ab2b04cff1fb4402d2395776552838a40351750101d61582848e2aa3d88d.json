{"ast":null,"code":"import axios from 'axios';\nimport { fetchSingleTableData, fetchStructureData } from \"./fetch_records.js\";\nconst API_BASE_URL = 'http://127.0.0.1:5000/api';\n\n/*export const fetchRecords = async () => {\n  const response = await axios.get(`${API_BASE_URL}/records`);\n  return response.data.records;\n};\n\nexport const createRecord = async (data) => {\n  const response = await axios.post(`${API_BASE_URL}/records`, data);\n  return response.data;\n};*/\n\nconst fetchWaterObjects = async () => {\n  try {\n    // 1. Get organization ID\n    const orgData = JSON.parse(localStorage.getItem(\"org\"));\n    console.log(orgData);\n    const orgId = orgData === null || orgData === void 0 ? void 0 : orgData.id;\n    if (!orgId) throw new Error(\"Organization ID not found in user data\");\n    console.log(orgId);\n\n    // 2. Fetch all water points\n    const allWaterPoints = await fetchSingleTableData('water_point');\n\n    // 3. Filter water points by organization\n    const orgWaterPoints = allWaterPoints.filter(point => {\n      var _point$organisation_i;\n      return ((_point$organisation_i = point.organisation_id) === null || _point$organisation_i === void 0 ? void 0 : _point$organisation_i.toString()) === orgId.toString();\n    });\n\n    // 4. Collect water_body IDs\n    const waterBodyIds = [...new Set(orgWaterPoints.map(p => p.water_body_id))].filter(id => id !== undefined && id !== null);\n    if (waterBodyIds.length === 0) return [];\n    console.log(waterBodyIds);\n\n    // 5. Fetch filtered water objects\n    const response = await fetchStructureData('water_object_ref', {\n      field: 'id',\n      operator: 'in',\n      value: waterBodyIds\n    });\n    return response.data || [];\n  } catch (error) {\n    console.error(\"Ошибка при загрузке водных объектов:\", error);\n    throw error; // Пробрасываем ошибку дальше\n  }\n};\n\n// export default fetchWaterObjects;\n\nconst sendQuarterData = async (waterObjectCode, quarter, data) => {\n  const token = localStorage.getItem('jwtToken');\n  try {\n    let send_form = 'send_quarter';\n    console.log(waterObjectCode);\n    const response = await axios.post(`${API_BASE_URL}/send_form`, {\n      waterObjectCode,\n      quarter,\n      data,\n      send_form\n    }, {\n      headers: {\n        'tokenJWTAuthorization': token // Передаем токен в заголовке\n      },\n      withCredentials: true\n    });\n    return response.data; // Возвращаем данные ответа\n  } catch (error) {\n    throw new Error(\"Ошибка при отправке данных: \" + error.message);\n  }\n};\nexport { sendQuarterData, fetchWaterObjects };","map":{"version":3,"names":["axios","fetchSingleTableData","fetchStructureData","API_BASE_URL","fetchWaterObjects","orgData","JSON","parse","localStorage","getItem","console","log","orgId","id","Error","allWaterPoints","orgWaterPoints","filter","point","_point$organisation_i","organisation_id","toString","waterBodyIds","Set","map","p","water_body_id","undefined","length","response","field","operator","value","data","error","sendQuarterData","waterObjectCode","quarter","token","send_form","post","headers","withCredentials","message"],"sources":["/home/noir/projects/diplom/front/src/api/records.js"],"sourcesContent":["import axios from 'axios';\n\nimport {fetchSingleTableData, fetchStructureData } from \"./fetch_records.js\";\n\nconst API_BASE_URL = 'http://127.0.0.1:5000/api';\n\n/*export const fetchRecords = async () => {\n  const response = await axios.get(`${API_BASE_URL}/records`);\n  return response.data.records;\n};\n\nexport const createRecord = async (data) => {\n  const response = await axios.post(`${API_BASE_URL}/records`, data);\n  return response.data;\n};*/\n\n\nconst fetchWaterObjects = async () => {\n  try {\n    // 1. Get organization ID\n    const orgData = JSON.parse(localStorage.getItem(\"org\"));\n    console.log(orgData);\n    const orgId = orgData?.id;\n    if (!orgId) throw new Error(\"Organization ID not found in user data\");\n\n    console.log(orgId);\n\n    // 2. Fetch all water points\n    const allWaterPoints = await fetchSingleTableData('water_point');\n\n    // 3. Filter water points by organization\n    const orgWaterPoints = allWaterPoints.filter(\n      point => point.organisation_id?.toString() === orgId.toString()\n    );\n\n    // 4. Collect water_body IDs\n    const waterBodyIds = [...new Set(\n      orgWaterPoints.map(p => p.water_body_id)\n    )].filter(id => id !== undefined && id !== null);\n\n    if (waterBodyIds.length === 0) return [];\n\n    console.log(waterBodyIds)\n\n    // 5. Fetch filtered water objects\n    const response = await fetchStructureData(\n      'water_object_ref',\n      {\n        field: 'id',\n        operator: 'in',\n        value: waterBodyIds\n      }\n    );\n\n    return response.data || [];\n\n\n  } catch (error) {\n    console.error(\"Ошибка при загрузке водных объектов:\", error);\n    throw error; // Пробрасываем ошибку дальше\n  }\n};\n\n// export default fetchWaterObjects;\n\nconst sendQuarterData = async (waterObjectCode, quarter, data) => {\n  const token = localStorage.getItem('jwtToken');\n\n\n  try {\n    let send_form = 'send_quarter';\n    console.log(waterObjectCode);\n    const response = await axios.post(`${API_BASE_URL}/send_form`, {\n      waterObjectCode,\n      quarter,\n      data,\n      send_form\n    }, {\n      headers: {\n        'tokenJWTAuthorization': token // Передаем токен в заголовке\n      },\n      withCredentials: true\n    });\n\n    return response.data; // Возвращаем данные ответа\n  } catch (error) {\n    throw new Error(\"Ошибка при отправке данных: \" + error.message);\n  }\n};\n\nexport {sendQuarterData, fetchWaterObjects};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,SAAQC,oBAAoB,EAAEC,kBAAkB,QAAQ,oBAAoB;AAE5E,MAAMC,YAAY,GAAG,2BAA2B;;AAEhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA,MAAMC,iBAAiB,GAAG,MAAAA,CAAA,KAAY;EACpC,IAAI;IACF;IACA,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC,CAAC;IACvDC,OAAO,CAACC,GAAG,CAACN,OAAO,CAAC;IACpB,MAAMO,KAAK,GAAGP,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEQ,EAAE;IACzB,IAAI,CAACD,KAAK,EAAE,MAAM,IAAIE,KAAK,CAAC,wCAAwC,CAAC;IAErEJ,OAAO,CAACC,GAAG,CAACC,KAAK,CAAC;;IAElB;IACA,MAAMG,cAAc,GAAG,MAAMd,oBAAoB,CAAC,aAAa,CAAC;;IAEhE;IACA,MAAMe,cAAc,GAAGD,cAAc,CAACE,MAAM,CAC1CC,KAAK;MAAA,IAAAC,qBAAA;MAAA,OAAI,EAAAA,qBAAA,GAAAD,KAAK,CAACE,eAAe,cAAAD,qBAAA,uBAArBA,qBAAA,CAAuBE,QAAQ,CAAC,CAAC,MAAKT,KAAK,CAACS,QAAQ,CAAC,CAAC;IAAA,CACjE,CAAC;;IAED;IACA,MAAMC,YAAY,GAAG,CAAC,GAAG,IAAIC,GAAG,CAC9BP,cAAc,CAACQ,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACC,aAAa,CACzC,CAAC,CAAC,CAACT,MAAM,CAACJ,EAAE,IAAIA,EAAE,KAAKc,SAAS,IAAId,EAAE,KAAK,IAAI,CAAC;IAEhD,IAAIS,YAAY,CAACM,MAAM,KAAK,CAAC,EAAE,OAAO,EAAE;IAExClB,OAAO,CAACC,GAAG,CAACW,YAAY,CAAC;;IAEzB;IACA,MAAMO,QAAQ,GAAG,MAAM3B,kBAAkB,CACvC,kBAAkB,EAClB;MACE4B,KAAK,EAAE,IAAI;MACXC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAEV;IACT,CACF,CAAC;IAED,OAAOO,QAAQ,CAACI,IAAI,IAAI,EAAE;EAG5B,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdxB,OAAO,CAACwB,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;IAC5D,MAAMA,KAAK,CAAC,CAAC;EACf;AACF,CAAC;;AAED;;AAEA,MAAMC,eAAe,GAAG,MAAAA,CAAOC,eAAe,EAAEC,OAAO,EAAEJ,IAAI,KAAK;EAChE,MAAMK,KAAK,GAAG9B,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;EAG9C,IAAI;IACF,IAAI8B,SAAS,GAAG,cAAc;IAC9B7B,OAAO,CAACC,GAAG,CAACyB,eAAe,CAAC;IAC5B,MAAMP,QAAQ,GAAG,MAAM7B,KAAK,CAACwC,IAAI,CAAC,GAAGrC,YAAY,YAAY,EAAE;MAC7DiC,eAAe;MACfC,OAAO;MACPJ,IAAI;MACJM;IACF,CAAC,EAAE;MACDE,OAAO,EAAE;QACP,uBAAuB,EAAEH,KAAK,CAAC;MACjC,CAAC;MACDI,eAAe,EAAE;IACnB,CAAC,CAAC;IAEF,OAAOb,QAAQ,CAACI,IAAI,CAAC,CAAC;EACxB,CAAC,CAAC,OAAOC,KAAK,EAAE;IACd,MAAM,IAAIpB,KAAK,CAAC,8BAA8B,GAAGoB,KAAK,CAACS,OAAO,CAAC;EACjE;AACF,CAAC;AAED,SAAQR,eAAe,EAAE/B,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}