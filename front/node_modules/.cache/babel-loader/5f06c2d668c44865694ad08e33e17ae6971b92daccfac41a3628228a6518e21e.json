{"ast":null,"code":"var _jsxFileName = \"/home/noir/projects/diplom/front/src/components/FileUpload.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { fetchFile } from \"../api/fetch_files\";\nimport { deleteFile } from \"../api/add_files\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst FileUpload = ({\n  label,\n  accept,\n  icon,\n  entityType,\n  entityId,\n  fileType,\n  preview = false,\n  onUpload\n}) => {\n  _s();\n  const [file, setFile] = useState(null);\n  const [fileUrl, setFileUrl] = useState(null);\n  const [showPreview, setShowPreview] = useState(false);\n  useEffect(() => {\n    // При монтировании компонента проверяем, есть ли файл на сервере\n    const checkExistingFile = async () => {\n      const url = await fetchFile(entityType, entityId, fileType);\n      setFileUrl(url);\n    };\n    checkExistingFile();\n  }, [entityType, entityId, fileType]);\n  const handleChange = e => {\n    const selectedFile = e.target.files[0];\n    setFile(selectedFile);\n    if (onUpload && selectedFile) {\n      onUpload(selectedFile, {\n        entityType,\n        entityId,\n        fileType\n      });\n    }\n  };\n  const handleDelete = async () => {\n    if (fileUrl) {\n      const fileName = fileUrl.substring(fileUrl.lastIndexOf(\"/\") + 1);\n      const success = await deleteFile(entityType, entityId, fileType, fileName);\n      if (success) {\n        setFileUrl(null); // Обновляем состояние, чтобы скрыть файл\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"file-upload\",\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      children: label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      accept: accept,\n      onChange: handleChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 9\n    }, this), fileUrl ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"file-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        onClick: () => preview && setShowPreview(true),\n        style: {\n          cursor: preview ? \"pointer\" : \"default\"\n        },\n        title: preview ? \"Просмотреть файл\" : \"\",\n        children: icon\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: fileUrl.substring(fileUrl.lastIndexOf(\"/\") + 1)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleDelete,\n        children: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 13\n    }, this) : file ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"file-info\",\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        children: file.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }, this) : null, showPreview && preview && file && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal\",\n      onClick: () => setShowPreview(false),\n      style: {\n        position: \"fixed\",\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: \"rgba(0,0,0,0.7)\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        zIndex: 1000\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: \"#fff\",\n          padding: 20,\n          maxWidth: \"90vw\",\n          maxHeight: \"90vh\"\n        },\n        onClick: e => e.stopPropagation(),\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setShowPreview(false),\n          children: \"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"iframe\", {\n          src: URL.createObjectURL(file),\n          width: \"600px\",\n          height: \"800px\",\n          title: \"Preview\",\n          style: {\n            border: \"none\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 9\n  }, this);\n};\n_s(FileUpload, \"lwmCvNsGV9VRnCvqICcfGe8X/E8=\");\n_c = FileUpload;\nexport default FileUpload;\nvar _c;\n$RefreshReg$(_c, \"FileUpload\");","map":{"version":3,"names":["React","useState","useEffect","fetchFile","deleteFile","jsxDEV","_jsxDEV","FileUpload","label","accept","icon","entityType","entityId","fileType","preview","onUpload","_s","file","setFile","fileUrl","setFileUrl","showPreview","setShowPreview","checkExistingFile","url","handleChange","e","selectedFile","target","files","handleDelete","fileName","substring","lastIndexOf","success","className","children","_jsxFileName","lineNumber","columnNumber","type","onChange","onClick","style","cursor","title","name","position","top","left","right","bottom","backgroundColor","display","justifyContent","alignItems","zIndex","background","padding","maxWidth","maxHeight","stopPropagation","src","URL","createObjectURL","width","height","border","_c","$RefreshReg$"],"sources":["/home/noir/projects/diplom/front/src/components/FileUpload.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { fetchFile } from \"../api/fetch_files\";\nimport { deleteFile } from \"../api/add_files\";\n\nconst FileUpload = ({\n    label,\n    accept,\n    icon,\n    entityType,\n    entityId,\n    fileType,\n    preview = false,\n    onUpload,\n}) => {\n    const [file, setFile] = useState(null);\n    const [fileUrl, setFileUrl] = useState(null);\n    const [showPreview, setShowPreview] = useState(false);\n\n    useEffect(() => {\n        // При монтировании компонента проверяем, есть ли файл на сервере\n        const checkExistingFile = async () => {\n            const url = await fetchFile(entityType, entityId, fileType);\n            setFileUrl(url);\n        };\n        checkExistingFile();\n    }, [entityType, entityId, fileType]);\n\n    const handleChange = (e) => {\n        const selectedFile = e.target.files[0];\n        setFile(selectedFile);\n        if (onUpload && selectedFile) {\n            onUpload(selectedFile, { entityType, entityId, fileType });\n        }\n    };\n\n    const handleDelete = async () => {\n        if (fileUrl) {\n            const fileName = fileUrl.substring(fileUrl.lastIndexOf(\"/\") + 1);\n            const success = await deleteFile(entityType, entityId, fileType, fileName);\n            if (success) {\n                setFileUrl(null); // Обновляем состояние, чтобы скрыть файл\n            }\n        }\n    };\n\n    return (\n        <div className=\"file-upload\">\n        <label>{label}</label>\n        <input type=\"file\" accept={accept} onChange={handleChange} />\n\n        {fileUrl ? (\n            <div className=\"file-info\">\n            <span\n            onClick={() => preview && setShowPreview(true)}\n            style={{ cursor: preview ? \"pointer\" : \"default\" }}\n            title={preview ? \"Просмотреть файл\" : \"\"}\n            >\n            {icon}\n            </span>\n            <span>{fileUrl.substring(fileUrl.lastIndexOf(\"/\") + 1)}</span>\n            <button onClick={handleDelete}>Удалить</button>\n            </div>\n        ) : file ? (\n            <div className=\"file-info\">\n            <span>{file.name}</span>\n            </div>\n        ) : null}\n\n        {showPreview && preview && file && (\n            <div\n            className=\"modal\"\n            onClick={() => setShowPreview(false)}\n            style={{\n                position: \"fixed\",\n                top: 0,\n                left: 0,\n                right: 0,\n                bottom: 0,\n                backgroundColor: \"rgba(0,0,0,0.7)\",\n                                            display: \"flex\",\n                                            justifyContent: \"center\",\n                                            alignItems: \"center\",\n                                            zIndex: 1000,\n            }}\n            >\n            <div\n            style={{\n                background: \"#fff\",\n                padding: 20,\n                maxWidth: \"90vw\",\n                maxHeight: \"90vh\",\n            }}\n            onClick={(e) => e.stopPropagation()}\n            >\n            <button onClick={() => setShowPreview(false)}>Закрыть</button>\n            <iframe\n            src={URL.createObjectURL(file)}\n            width=\"600px\"\n            height=\"800px\"\n            title=\"Preview\"\n            style={{ border: \"none\" }}\n            />\n            </div>\n            </div>\n        )}\n        </div>\n    );\n};\n\nexport default FileUpload;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}