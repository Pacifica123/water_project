{"ast":null,"code":"// import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nconst API_URL_STRUCT = \"http://127.0.0.1:5000/api/get_struct\";\nconst API_URL_SINGLE = \"http://127.0.0.1:5000/api/edit_reference\";\n\n/**\n * Универсальная функция для получения данных структуры из API.\n * @param {string} structName - Имя структуры для запроса.\n * @param {object} filters - Объект с фильтрами для запроса (ключ: значение).\n * @param {string} token - JWT токен для авторизации (опционально).\n * @returns {Promise<object>} - Промис, разрешающийся в данные структуры или отклоняющийся с ошибкой.\n */\nconst fetchStructureData = async (structName, filters = {}, token = null) => {\n  try {\n    const params = {\n      struct_name: structName,\n      ...Object.entries(filters).reduce((acc, [key, value]) => {\n        acc[`filter_k`] = key;\n        acc[`filter_v`] = value;\n        return acc;\n      }, {})\n    };\n    const headers = token ? {\n      'tokenJWTAuthorization': token\n    } : {};\n    const response = await axios.get(API_URL_STRUCT, {\n      params: params,\n      headers: headers,\n      withCredentials: true\n    });\n    if (response.status >= 400) {\n      throw new Error(`HTTP error! Status: ${response.status}`);\n    }\n    const data = response.data;\n    console.log(JSON.stringify(data, null, 4));\n    if (!data.success) {\n      throw new Error(`API Error: ${data.error}`);\n    }\n    console.log(\"Данные успешно получены:\");\n    return data;\n  } catch (error) {\n    console.error(\"Ошибка при получении структуры:\", error);\n    throw error; // Пробрасываем ошибку дальше\n  }\n};\n\n// export default fetchStructureData;\n\n// Пример использования:\n// 1. Импортировать функцию в ваш компонент:\n//    import fetchStructureData from './path/to/fetchStructureData';\n\n// 2. Вызвать функцию, передав необходимые параметры:\n//    const fetchData = async () => {\n//      try {\n//        const data = await fetchStructureData(\n//          'point_consumption',\n//          { organisation_id: '2' },\n//          localStorage.getItem('jwtToken')\n//        );\n//        // Обработайте полученные данные\n//        console.log(data);\n//      } catch (error) {\n//        // Обработайте ошибку\n//        console.error(error);\n//      }\n//    };\n\n//    fetchData();\n\nconst fetchSingleTableData = async tableName => {\n  try {\n    const token = localStorage.getItem('jwtToken');\n    console.log(tableName);\n    const headers = token ? {\n      'tokenJWTAuthorization': token\n    } : {};\n    const response = await axios.get(API_URL_SINGLE, {\n      headers: headers,\n      params: {\n        reference_select: tableName\n      },\n      withCredentials: true\n    });\n    // console.log(response);\n\n    if (response.status >= 400) {\n      console.log(\"Ошибка HTTP: \", response);\n      return null;\n    }\n    const data = response.data;\n    const records = data.new_content;\n    console.log(\" --> Сейчас будет - \", data.selected_reference);\n    console.log(records);\n    if (!records || records.length === 0) {\n      console.log(\"Нет записей в таблице\");\n      return null;\n    }\n    return records;\n  } catch (error) {\n    console.log(\"Ошибка при получении данных таблицы:\", error.message);\n    return null;\n  }\n};\nexport { fetchStructureData, fetchSingleTableData };","map":{"version":3,"names":["axios","API_URL_STRUCT","API_URL_SINGLE","fetchStructureData","structName","filters","token","params","struct_name","Object","entries","reduce","acc","key","value","headers","response","get","withCredentials","status","Error","data","console","log","JSON","stringify","success","error","fetchSingleTableData","tableName","localStorage","getItem","reference_select","records","new_content","selected_reference","length","message"],"sources":["/home/noir/projects/diplom/front/src/api/fetch_records.js"],"sourcesContent":["// import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\n\nconst API_URL_STRUCT = \"http://127.0.0.1:5000/api/get_struct\";\nconst API_URL_SINGLE = \"http://127.0.0.1:5000/api/edit_reference\";\n\n/**\n * Универсальная функция для получения данных структуры из API.\n * @param {string} structName - Имя структуры для запроса.\n * @param {object} filters - Объект с фильтрами для запроса (ключ: значение).\n * @param {string} token - JWT токен для авторизации (опционально).\n * @returns {Promise<object>} - Промис, разрешающийся в данные структуры или отклоняющийся с ошибкой.\n */\nconst fetchStructureData = async (structName, filters = {}, token = null) => {\n    try {\n        const params = {\n            struct_name: structName,\n            ...Object.entries(filters).reduce((acc, [key, value]) => {\n                acc[`filter_k`] = key;\n                acc[`filter_v`] = value;\n                return acc;\n            }, {})\n        };\n\n        const headers = token ? { 'tokenJWTAuthorization': token } : {};\n\n        const response = await axios.get(API_URL_STRUCT, {\n            params: params,\n            headers: headers,\n            withCredentials: true\n        });\n\n        if (response.status >= 400) {\n            throw new Error(`HTTP error! Status: ${response.status}`);\n        }\n\n        const data = response.data;\n\n        console.log(JSON.stringify(data, null, 4));\n\n        if (!data.success) {\n            throw new Error(`API Error: ${data.error}`);\n        }\n\n        console.log(\"Данные успешно получены:\");\n\n        return data;\n    } catch (error) {\n        console.error(\"Ошибка при получении структуры:\", error);\n        throw error; // Пробрасываем ошибку дальше\n    }\n};\n\n// export default fetchStructureData;\n\n// Пример использования:\n// 1. Импортировать функцию в ваш компонент:\n//    import fetchStructureData from './path/to/fetchStructureData';\n\n// 2. Вызвать функцию, передав необходимые параметры:\n//    const fetchData = async () => {\n//      try {\n//        const data = await fetchStructureData(\n//          'point_consumption',\n//          { organisation_id: '2' },\n//          localStorage.getItem('jwtToken')\n//        );\n//        // Обработайте полученные данные\n//        console.log(data);\n//      } catch (error) {\n//        // Обработайте ошибку\n//        console.error(error);\n//      }\n//    };\n\n//    fetchData();\n\nconst fetchSingleTableData = async (tableName) => {\n    try {\n        const token = localStorage.getItem('jwtToken');\n        console.log(tableName);\n        const headers = token ? { 'tokenJWTAuthorization': token } : {};\n        const response = await axios.get(API_URL_SINGLE, {\n            headers: headers,\n            params: { reference_select: tableName },\n            withCredentials: true\n        });\n        // console.log(response);\n\n        if (response.status >= 400) {\n            console.log(\"Ошибка HTTP: \", response);\n            return null;\n        }\n\n        const data = response.data;\n        const records = data.new_content;\n\n        console.log(\" --> Сейчас будет - \", data.selected_reference)\n        console.log(records);\n\n        if (!records || records.length === 0) {\n            console.log(\"Нет записей в таблице\");\n            return null;\n        }\n\n        return records;\n    } catch (error) {\n        console.log(\"Ошибка при получении данных таблицы:\", error.message);\n        return null;\n    }\n};\n\nexport {fetchStructureData, fetchSingleTableData};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}